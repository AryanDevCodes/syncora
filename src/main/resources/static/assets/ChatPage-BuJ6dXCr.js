import{c as p,i as ee,k as ae,d as se,l as te,r as t,j as e,m as G,V as re,X as U}from"./index-C6EvfBZN.js";import{c as le}from"./contactApi-D_MIHxJr.js";import{P as ne}from"./plus-BhQw_i-H.js";import{P as F}from"./phone-I4FbMxVk.js";import{E as ie}from"./ellipsis-vertical-BcxsOoxB.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=p("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=p("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=p("Smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]);function je(){const{chats:d,activeChat:s,messages:o,setActiveChat:V,sendMessage:z,markAsRead:ce,refreshChats:K,createDirectChat:Q,createGroupChat:xe,loading:j,error:ge}=ee(),{isConnected:B,sendTyping:c,joinRoom:N,leaveRoom:k,typingUsers:v}=ae(),{user:x}=se(),{setActiveModule:O,setActiveRoom:W}=te(),[n,w]=t.useState(""),[g,X]=t.useState(""),[C,S]=t.useState(!1),[m,h]=t.useState(!1),[q,H]=t.useState([]),[E,i]=t.useState(!1),[l,A]=t.useState(""),[me,J]=t.useState(null),M=t.useRef(null),y=t.useRef(),Y=()=>{var a;(a=M.current)==null||a.scrollIntoView({behavior:"smooth"})};t.useEffect(()=>{Y()},[o]),t.useEffect(()=>{const a=s==null?void 0:s.id;return a&&N(a),()=>{a&&k(a)}},[s==null?void 0:s.id,N,k]),t.useEffect(()=>{K(),Z()},[]);const Z=async()=>{try{const a=await le.getAllContacts();H(a)}catch(a){console.error("Failed to fetch contacts:",a)}},T=async()=>{if(n.trim())try{await z(n),console.log("ChatPage: sendMessage resolved for",s==null?void 0:s.id),w(""),m&&s&&(c(s.id,!1),h(!1))}catch(a){console.error("Failed to send message:",a)}},_=a=>{w(a),s&&(!m&&a.trim()&&(c(s.id,!0),h(!0)),y.current&&clearTimeout(y.current),y.current=setTimeout(()=>{m&&(c(s.id,!1),h(!1))},2e3))},u=async a=>{try{await Q(a),i(!1),A(""),J(null)}catch(r){console.error("Failed to create chat:",r)}},D=()=>{if(s){const a=`chat-${s.id}`;W(a),O("video"),window.location.href=`/video?roomId=${a}`}},P=a=>{const r=new Date(a),f=new Date().getTime()-r.getTime(),b=Math.floor(f/6e4),$=Math.floor(f/36e5),R=Math.floor(f/864e5);return b<1?"now":b<60?`${b}m`:$<24?`${$}h`:R<7?`${R}d`:r.toLocaleDateString()},I=(d==null?void 0:d.filter(a=>a.name.toLowerCase().includes(g.toLowerCase())))||[];return e.jsxs("div",{className:"flex h-full max-h-full bg-white dark:bg-gray-900 overflow-hidden",children:[e.jsxs("div",{className:"w-80 border-r border-gray-200 dark:border-gray-700 flex flex-col bg-white dark:bg-gray-900 h-full overflow-hidden",children:[e.jsxs("div",{className:"p-4 space-y-4 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Chats"}),e.jsxs("div",{className:"flex items-center gap-2",children:[B&&e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse",title:"Connected"}),e.jsx("button",{onClick:()=>i(!E),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition",children:e.jsx(ne,{className:"w-5 h-5 text-gray-700 dark:text-gray-300"})})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(G,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500"}),e.jsx("input",{type:"text",placeholder:"Search conversations...",value:g,onChange:a=>X(a.target.value),className:"w-full pl-10 pr-4 py-2 rounded-full bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:bg-gray-200 dark:focus:bg-gray-700 transition"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto min-h-0",children:j?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Loading..."})}):I.length>0?I.map(a=>e.jsxs("button",{onClick:()=>V(a),className:`w-full px-3 py-3 flex gap-3 hover:bg-gray-100 dark:hover:bg-gray-800 transition ${(s==null?void 0:s.id)===a.id?"bg-gray-100 dark:bg-gray-800":""}`,children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-400 to-blue-600 flex items-center justify-center text-lg font-bold text-white",children:a.isGroup?"ðŸ‘¥":a.name.charAt(0).toUpperCase()}),a.isGroup&&e.jsx("div",{className:"absolute -bottom-1 -right-1 w-5 h-5 bg-gray-300 dark:bg-gray-600 rounded-full flex items-center justify-center text-xs font-bold text-gray-900 dark:text-white border-2 border-white dark:border-gray-900",children:a.memberEmails.length})]}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white truncate",children:a.name}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 whitespace-nowrap",children:a.lastMessageTime?P(a.lastMessageTime):""})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 truncate",children:a.lastMessagePreview||"No messages yet"}),a.unreadCount>0&&e.jsx("div",{className:"flex-shrink-0 w-5 h-5 bg-blue-500 rounded-full flex items-center justify-center text-white text-xs font-bold",children:a.unreadCount})]})]})]},a.id)):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:g?"No conversations found":"No conversations yet"})})})]}),s?e.jsxs("div",{className:"flex-1 flex flex-col bg-gray-50 dark:bg-gray-950 h-full overflow-hidden",children:[e.jsxs("div",{className:"h-14 bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 px-6 flex items-center justify-between shadow-sm flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-400 to-blue-600 flex items-center justify-center text-white font-bold",children:s.isGroup?"ðŸ‘¥":s.name.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold text-gray-900 dark:text-white",children:s.name}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:s.isGroup?`${s.memberEmails.length} members`:"Active now"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition",children:e.jsx(F,{className:"w-5 h-5 text-gray-700 dark:text-gray-300"})}),e.jsx("button",{onClick:D,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition",children:e.jsx(re,{className:"w-5 h-5 text-gray-700 dark:text-gray-300"})}),e.jsx("button",{className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition",children:e.jsx(G,{className:"w-5 h-5 text-gray-700 dark:text-gray-300"})}),e.jsx("button",{onClick:()=>S(!C),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition",children:e.jsx(ie,{className:"w-5 h-5 text-gray-700 dark:text-gray-300"})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto overflow-x-hidden p-4 h-0",children:e.jsx("div",{className:"space-y-3 flex flex-col",children:o.length===0?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No messages yet"})}):e.jsxs(e.Fragment,{children:[o.map(a=>{const r=a.senderEmail===(x==null?void 0:x.email);return e.jsx("div",{className:`flex ${r?"justify-end":"justify-start"} animate-in fade-in-0 slide-in-from-bottom-2`,children:e.jsxs("div",{className:`max-w-xs px-3 py-2 rounded-lg ${r?"bg-blue-500 text-white rounded-br-none":"bg-gray-200 dark:bg-gray-800 text-gray-900 dark:text-white rounded-bl-none"}`,children:[!r&&e.jsx("p",{className:"text-xs font-semibold mb-1 text-gray-600 dark:text-gray-300",children:a.senderEmail}),e.jsx("p",{className:"text-sm break-words",children:a.content}),e.jsxs("p",{className:`text-xs mt-1 ${r?"text-blue-100":"text-gray-500 dark:text-gray-400"}`,children:[P(a.sentAt),r&&e.jsx("span",{className:"ml-1",children:a.read?"âœ“âœ“":a.delivered?"âœ“":""})]})]})},a.id)}),v.length>0&&e.jsx("div",{className:"flex justify-start animate-in fade-in-0",children:e.jsx("div",{className:"max-w-xs px-3 py-2 rounded-lg bg-gray-200 dark:bg-gray-800 rounded-bl-none",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-600 dark:bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 bg-gray-600 dark:bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 bg-gray-600 dark:bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]}),e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-2",children:[v[0]," is typing..."]})]})})}),e.jsx("div",{ref:M})]})})}),e.jsx("div",{className:"bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700 p-3 space-y-2 flex-shrink-0",children:e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("button",{className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition flex-shrink-0",children:e.jsx(de,{className:"w-5 h-5 text-gray-700 dark:text-gray-300"})}),e.jsx("input",{type:"text",placeholder:"Type a message...",value:n,onChange:a=>_(a.target.value),onKeyPress:a=>a.key==="Enter"&&!a.shiftKey&&T(),className:"flex-1 px-4 py-2 rounded-full bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:bg-gray-200 dark:focus:bg-gray-700 transition resize-none"}),e.jsx("button",{className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition flex-shrink-0",children:e.jsx(oe,{className:"w-5 h-5 text-gray-700 dark:text-gray-300"})}),e.jsx("button",{onClick:T,disabled:!n.trim()||j,className:"p-2 bg-blue-500 hover:bg-blue-600 disabled:bg-gray-300 dark:disabled:bg-gray-700 text-white rounded-full transition flex-shrink-0",children:e.jsx(L,{className:"w-5 h-5"})})]})})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center bg-gray-50 dark:bg-gray-950",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"w-24 h-24 mx-auto bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center",children:e.jsx(L,{className:"w-12 h-12 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Welcome to Chat"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Select a conversation to start messaging"})]})]})}),C&&s&&e.jsxs("div",{className:"w-72 border-l border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 flex flex-col shadow-lg h-full overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between flex-shrink-0",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Details"}),e.jsx("button",{onClick:()=>S(!1),className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-800 rounded",children:e.jsx(U,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 h-0",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-blue-400 to-blue-600 flex items-center justify-center text-3xl mb-2",children:s.isGroup?"ðŸ‘¥":s.name.charAt(0).toUpperCase()}),e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:s.name}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:s.isGroup?`${s.memberEmails.length} members`:"Direct message"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:D,className:"w-full px-4 py-2 rounded-lg bg-blue-500 text-white font-medium hover:bg-blue-600 transition flex items-center justify-center gap-2",children:[e.jsx(F,{className:"w-4 h-4"}),"Call"]}),e.jsx("button",{className:"w-full px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-white font-medium hover:bg-gray-200 dark:hover:bg-gray-700 transition",children:"Search"})]}),s.isGroup&&e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsxs("h5",{className:"font-semibold text-gray-900 dark:text-white text-sm mb-3",children:["Members (",s.memberEmails.length,")"]}),e.jsx("div",{className:"space-y-2",children:s.memberEmails.map((a,r)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-blue-400 to-blue-600 flex items-center justify-center text-white font-bold text-sm",children:a.charAt(0).toUpperCase()}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:a})})]},r))})]})]})]}),E&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:()=>i(!1),children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg p-6 w-96 max-h-96 overflow-y-auto",onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Start New Chat"}),e.jsx("button",{onClick:()=>i(!1),className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-800 rounded",children:e.jsx(U,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("input",{type:"email",placeholder:"Enter email address...",value:l,onChange:a=>A(a.target.value),onKeyPress:a=>a.key==="Enter"&&l.trim()&&u(l),className:"w-full px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:bg-gray-200 dark:focus:bg-gray-700"}),e.jsx("button",{onClick:()=>l.trim()&&u(l),disabled:!l.trim(),className:"w-full mt-2 px-4 py-2 rounded-lg bg-blue-500 text-white font-medium hover:bg-blue-600 disabled:bg-gray-300 dark:disabled:bg-gray-700 transition",children:"Start Chat"})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white mb-2",children:"Or select from contacts"}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:q.map(a=>e.jsxs("button",{onClick:()=>u(a.email),className:"w-full flex items-center gap-2 p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-800 transition",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-blue-400 to-blue-600 flex items-center justify-center text-white font-bold text-sm",children:a.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:a.name}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a.email})]})]},a.id))})]})]})]})})]})}export{je as default};
